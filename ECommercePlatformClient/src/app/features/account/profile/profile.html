<div class="account-content-card">
  
  <div class="card-header d-flex align-items-center justify-content-between mb-4 pb-3 border-bottom border-secondary border-opacity-25">
    <div>
      <h3 class="text-white mb-1">Profil Bilgilerim</h3>
      <p class="text-gray-500 mb-0 small">Kişisel bilgilerinizi ve adresinizi güncelleyin.</p>
    </div>
  </div>

  <!-- 1. YÜKLENİYOR DURUMU -->
  <!-- Veri yoksa ve yükleniyorsa spinner göster -->
  @if (loading() && !profile()) { 
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="text-gray-500 mt-3 small">Bilgiler yükleniyor...</p>
    </div>
  } 

  <!-- 2. HATA DURUMU -->
  @else if (error() && !profile()) {
    <div class="alert alert-danger d-flex align-items-center mb-4 border-0 bg-danger bg-opacity-10 text-danger">
      <i class="bi bi-exclamation-circle-fill me-2"></i>
      <div>
        <strong>Hata:</strong> {{ error() }}
        <button class="btn btn-link btn-sm text-danger p-0 ms-2" (click)="loadProfile()">Tekrar Dene</button>
      </div>
    </div>
  }

  <!-- 3. FORM İÇERİĞİ -->
  @else {
    
    <!-- Başarı Mesajı -->
    @if (successMessage()) {
      <div class="alert alert-success d-flex align-items-center mb-4 border-0 bg-success bg-opacity-10 text-success">
        <i class="bi bi-check-circle-fill me-2"></i>
        {{ successMessage() }}
      </div>
    }
    
    <!-- Hata Mesajı (Güncelleme sırasında) -->
    @if (error()) {
      <div class="alert alert-danger d-flex align-items-center mb-4 border-0 bg-danger bg-opacity-10 text-danger">
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        {{ error() }}
      </div>
    }

    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
      
      <!-- KİŞİSEL BİLGİLER -->
      <div class="section-group mb-5">
        <h5 class="section-title text-primary mb-3 small text-uppercase fw-bold d-flex align-items-center gap-2">
          <i class="bi bi-person"></i> Kişisel Bilgiler
        </h5>
        
        <div class="row g-3">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Ad</label>
              <input type="text" class="form-control" formControlName="firstName" placeholder="Adınız">
              @if(profileForm.get('firstName')?.touched && profileForm.get('firstName')?.invalid) {
                <small class="text-danger mt-1 d-block">Ad alanı zorunludur.</small>
              }
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Soyad</label>
              <input type="text" class="form-control" formControlName="lastName" placeholder="Soyadınız">
               @if(profileForm.get('lastName')?.touched && profileForm.get('lastName')?.invalid) {
                <small class="text-danger mt-1 d-block">Soyad alanı zorunludur.</small>
              }
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">E-Posta</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent border-end-0 text-gray-500 border-secondary border-opacity-25">
                  <i class="bi bi-envelope"></i>
                </span>
                <input type="email" class="form-control border-start-0 ps-0" formControlName="email">
              </div>
              <small class="text-muted fst-italic mt-1 d-block" style="font-size: 0.75rem;">
                <i class="bi bi-lock-fill me-1"></i>Değiştirilemez.
              </small>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Telefon</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent border-end-0 text-gray-500 border-secondary border-opacity-25">
                  <i class="bi bi-telephone"></i>
                </span>
                <input type="tel" class="form-control border-start-0 ps-0" formControlName="phoneNumber" placeholder="5XX XXX XX XX">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ADRES BİLGİLERİ -->
      <div class="section-group mb-4" formGroupName="address">
        <h5 class="section-title text-primary mb-3 small text-uppercase fw-bold d-flex align-items-center gap-2">
          <i class="bi bi-geo-alt"></i> Adres Bilgileri
        </h5>
        
        <div class="row g-3">
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Şehir (İl)</label>
              <input type="text" class="form-control" formControlName="city" placeholder="Örn: İstanbul">
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">İlçe</label>
              <input type="text" class="form-control" formControlName="district" placeholder="Örn: Kadıköy">
            </div>
          </div>
          
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Posta Kodu</label>
              <input type="text" class="form-control" formControlName="zipCode" placeholder="34000">
            </div>
          </div>
          
          <div class="col-12">
            <div class="form-group">
              <label class="form-label">Cadde/Sokak</label>
              <input type="text" class="form-control" formControlName="street" placeholder="Bağdat Caddesi, No: 1">
            </div>
          </div>
          
          <div class="col-12">
            <div class="form-group">
              <label class="form-label">Açık Adres</label>
              <textarea class="form-control" rows="3" formControlName="fullAddress" placeholder="Adres tarifi, bina adı, daire no vb."></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- BUTONLAR -->
      <div class="form-actions d-flex justify-content-end mt-5 pt-3 border-top border-secondary border-opacity-25">
        <button type="button" class="btn btn-glass text-gray-400 me-3" (click)="loadProfile()">
          Sıfırla
        </button>
        
        <button type="submit" class="btn btn-primary px-5 btn-glow" [disabled]="profileForm.invalid || submitting()">
          @if (submitting()) {
            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
            Kaydediliyor...
          } @else {
            <i class="bi bi-check-lg me-2"></i> Değişiklikleri Kaydet
          }
        </button>
      </div>

    </form>
  }
</div>
